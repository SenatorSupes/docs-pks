---
title: Configuring and Managing Clusters Using VM&nbsp;extensions
owner: TKGI
---

This topic describes how to configure Kubernetes clusters with BOSH VM&nbsp;extensions using <%= vars.product_full %> (<%= vars.k8s_runtime_abbr %>). 

## <a id='overview'></a>Overview

<%= vars.k8s_runtime_abbr %> supports configuring Kubernetes clusters using BOSH VM&nbsp;extensions. You can configure Linux and Windows clusters

## <a id='create-cluster'></a>Create a Cluster Using a Bosh VM Extension

To create a new Kubernetes cluster configured with VM&nbsp;extensions:

1. Create a VM&nbsp;extensions configuration file. For more information, see [Create a Bosh VM Extension Configuration File](#create-configuration) below.  
1. To create a cluster using the VM&nbsp;extensions file:  

    ```
    tkgi create-cluster CLUSTER-NAME --config-file CONFIG-FILENAME
    ```
    Where:  
    * `CLUSTER-NAME` is the name of the cluster to create. 
    * `CONFIG-FILENAME` is the name of the VM extension configuration file created above. 

    Alternatively, you can simultaneously create the cluster with a compute profile by including the `--compute-profile` parameter and a compute profile name.  


## <a id='modify-cluster'></a>Configure a Cluster Using a Bosh VM Extension

To configure an existing Kubernetes cluster with VM&nbsp;extensions:

1. Create a VM&nbsp;extensions configuration file. For more information, see [Create a Bosh VM Extension Configuration File](#create-configuration) below.  
1. To modify a cluster using the VM&nbsp;extensions file:  

    ```
    tkgi update-cluster CLUSTER-NAME --config-file CONFIG-FILENAME
    ```
    Where:  
    * `CLUSTER-NAME` is the name of the cluster to modify. 
    * `CONFIG-FILENAME` is the name of the VM extension configuration file created above. 

    Alternatively, you can simultaneously modify the cluster with a compute profile by including the `--compute-profile` parameter and a compute profile name.  


    
## <a id='remove-configuration'></a>Remove a Bosh VM Extension From a Cluster

To remove VM&nbsp;extensions from an instance group:  

1. Create a VM extension configuration file containing the following:  

    ```
    {
        "name":"INSTANCE-GROUP",
        "vm_extension":{}
    }
    ```

    Where `INSTANCE-GROUP` is the name of the instance group VM&nbsp;extensions to be removed, 
    either `master`, `worker`, `windows-worker` or the node pool VM&nbsp;extensions instance group name.

1. To remove the VM&nbsp;extensions using the CLI:  

    ```
    tkgi update-cluster CLUSTER-NAME --config-file CONFIG-FILENAME
    ```
    Where:  
    * `CLUSTER-NAME` is the name of the cluster to remove VM&nbsp;extensions from. 
    * `CONFIG-FILENAME` is the name of the VM extension configuration file created above. 

    Alternatively, you can simultaneously update the cluster with a compute profile by including the `--compute-profile` parameter and a compute profile name.  


## <a id='create-configuration'></a>Create a Bosh VM Extension Configuration File

To create a VM&nbsp;extensions configuration file:

1. Create a new configuration file containing the following content:
    * **Linux Cluster VM Extension Configuration File Content**

        ```
{
    "instance_groups":[
      {
        "name":"master",
        "vm_extension":{
          VM-EXTENSIONS
          }
      },
      {
        "Name":"worker", //for windows workers, the name is “windows-worker”
        "vm_extension":{
          VM-EXTENSIONS
          }
      },  	
      {
        "name":"NODE-POOL-NAME", //for node pool name in the compute profile. For windows node pools, the name is “windows-worker-tiny-1”.
        "vm_extension":{
          VM-EXTENSIONS
          }
      }
   ]
}
        ```
        Where:  
        * `VM-EXTENSIONS` is the placeholder for the BOSH VM&nbsp;extensions to apply the Kubernetes cluster.  
        * `NODE-POOL-NAME` is the name of the node-pool. For Linux clusters the node pool name must be prefixed `worker-`. For example: `worker-tiny-1`.  
    * **Windows Worker VM Extension Configuration File Content**

        ```
{
    "instance_groups":[
      {
        "name":"master",
        "vm_extension":{
          VM-EXTENSIONS
          }
      },
      {
        "Name":"windows-worker",
        "vm_extension":{
          VM-EXTENSIONS
          }
      },  	
      {
        "name":"NODE-POOL-NAME",
        "vm_extension":{
       	   VM-EXTENSIONS
        }
      }
   ]
}
        ```
        Where:  
        * `VM-EXTENSIONS` is the placeholder for the BOSH VM&nbsp;extensions to apply the Kubernetes cluster.  
        * `NODE-POOL-NAME` is the instance group name for the node-pool VM&nbsp;extensions. 
        For Windows Workers the node pool instance group name must be prefixed `windows-worker-`. 
        For example: `windows-worker-tiny-1`.  
1. Replace the `VM-EXTENSIONS` for each instance group with the desired supported VM&nbsp;extensions.  
<br>
    The supported BOSH VM&nbsp;extensions are specific to each IaaS:
    * For AWS VM extension names, see: [VM Types / VM&nbsp;extensions](https://bosh.io/docs/aws-cpi/#resource-pools) in _Usage_ in the Cloud Foundry BOSH documentation.
    * For Azure VM extension names, see: [VM Types / VM&nbsp;extensions](https://bosh.io/docs/azure-cpi/#resource-pools) in _Usage_ in the Cloud Foundry BOSH documentation.
    * For vSphere VM extension names, see: [VM Types / VM&nbsp;extensions](https://bosh.io/docs/vsphere-cpi/#resource-pools) in _Usage_ in the Cloud Foundry BOSH documentation.

    For example:  

    ```
{
    "instance_groups":[
      {
        "name":"master",
        "vm_extension":{
          "cpu_hot_add_enabled": "true"
          }
      },
      {
        "Name":"windows-worker",
        "vm_extension":{
          "cpu_hot_add_enabled": "true"
          }
      },  	
      {
        "name":"worker-tiny-1",
        "vm_extension":{
       	   VM-EXTENSIONS
        }
      }
   ]
}
    ```  
