---
title: Monitoring Master/etcd Node VMs
owner: PKS
---

<strong><%= modified_date %></strong>

This topic describes how platform operators can monitor and retrieve metrics from
master/etcd node VMs in <%= vars.product_full %> deployments.

## <a id="overview"></a>Overview
<%# What is modifying what in the below sentence? What is valuable about this info?%>
etcd is an open source distributed key value store.
You can monitor Kubernetes cluster health by using metrics from etcd.
In <%= vars.product_short %>, etcd is co-located on Kubernetes master node VMs.
The master node VMs use etcd for service discovery and configuration sharing within the cluster.

For more information about etcd, see the [etcd documentation](https://github.com/etcd-io/etcd/tree/master/Documentation) on GitHub.

For more information about configuring master/etcd nodes in the <%= vars.product_tile %> tile, see the
Plans section of _Installing <%= vars.product_short %>_ for your IaaS:

* [vSphere](installing-pks-vsphere.html#plans)
* [vSphere with NSX-T Integration](installing-nsx-t.html#plans)
* [Google Cloud Platform (GCP)](installing-pks-gcp.html#plans)
* [Amazon Web Services (AWS)](installing-pks-aws.html#plans)
* [Azure](installing-pks-azure.html#plans)


## <a id="collect"></a>Collect Metrics Using etcd 

<%# What exactly is the agent doing? Where do they find it? Does it have a name? %>

You can configure an agent to read from the the `/metric` endpoint exposed by the etcd VM.
You can then connect a third-party monitoring service to etcdâ€¨ to retrieve cluster information
from the endpoint. You can also configure the agent to read infrastructure metrics from the [Node Exporter](link), if installed.

<%# What is a node exporter? Does it also provide metrics? An alternative to the /metrics endpoint? %>

For more information about monitoring etcd,
see [Monitoring etcd](https://github.com/etcd-io/etcd/blob/master/Documentation/op-guide/monitoring.md)
on GitHub. For example, the etcd documentation recommends using the open source Prometheus monitoring service.
For more information about using Prometheus, see the
[Prometheus documentation](https://prometheus.io/docs/introduction/overview/).

<%#LINK TO THE AVAILABLE METRICS%>

To monitor etcd using a monitoring service, you must do the following:

1. Enable node exporter (optional but recommended) [LINK](link).
<%#steps?%>
1. [Using TOML]()
1. Configure [telegraf within the tile](https://github.com/influxdata/telegraf/tree/1.11.0/plugins/outputs). 
1. Apply Changes.

### <a id="toml"></a> Create a Configuration File 

<%# INTRO %>

Create a configuration file in TOML format for your output plugin. TOML configuration files consist of key-value pairs. You can find samples within the [telgraf repo](https://github.com/influxdata/telegraf/tree/1.11.0/plugins/outputs) or use the following sample: 

```
[[outputs.http]]
   url="https://example.com"
   method="POST"
   data_format="JSON"
[[processors.override]]
  [processors.override.tags]
   'Director Name' = 'Adam Jones'
    TAG-KEY = "TAG-VALUE"
```

In this sample plugin configuration, the "Director Name" tag is assigned the value "Adam Jones" who is the BOSH Director. You can define any information as tag key-value pairs to make metrics results more human-readable. Some additional key-value pairs could include:

<%# INFO ABOUT WHY YOU SHOULD USE TAGS %>

<table>
    <tr>
      <th>Tag</th>
      <th>Description</th>
    </tr>
    <tr>
      <td>Director Name</td>
      <td>Use this to assign a recognizeable name to your bosh director</td>
    </tr>
    <tr>
      <td>Host?</td>
      <td>Hostname?</td>
    </tr>
</table>

### <a id="connect"></a> Configure Telegraf in the Tile

To connect a monitoring service to etcd, do the following:

1. From the **Ops Manager Installation Dashboard**, navigate to **<%= vars.product_tile %>** >
**Settings** > **Monitoring**.

1. Enable the Node Exporter on the master node. 
  The Node Exporter provides additional infrastructure metrics that are then available on the localhost of the master node. 

1. For **Setup Telegraf Outputs**, enter the contents from the [TOML configuration file](#toml) and tags for your monitoring service. 
If you do not want to output any BOSH metrics, leave the default `[[outputs.discard]]` value.
For information about TOML configurations, see [Create a Configuration FIle](#toml) above.

1. Click **Save**

1. Click **Apply Changes**.

## <a id="errors"></a>Troubleshoot etcd

We recommend working with Pivotal or VMware Support to troubleshoot master/etcd node VMs.
The monitoring and metrics data you retrieve from the master/etcd node VMs
can help the Support team diagnose and troubleshoot errors.
