---
title: Installing and Configuring NSX-T Data Center v3.0 for Tanzu Kubernetes Grid Integrated Edition
owner: TKGI-NSXT
---

This topic provides instructions for creating the NSX-T objects for the <%= vars.product_short %> control plane where Kubernetes clusters run.

##<a id='nsxt30-prereqs'></a> Required NSX-T Objects for the <%= vars.product_short %> Control Plane

To install TKGI on vSpher with NSX-T, you need the following NSX-T objects: 

- Tier-0 Gateway (also known as a Router)
- Pods IP Block
- Nodes IP Block 
- Floating IP Pool

  <img src="images/nsxt-objects-k8s.png">

For more information, see [Required NSX-T Objects for TKGI](./nsxt-create-objects.html).

The following instructions despribe how to create these objects. You will need to create them using the appropriate tab. If you are using the Policy API, create these objects using the Policy tab. If you are using the Management API, create them using the Manager tab.

##<a id='nsxt30-t0-router-create'></a> Create Tier-0 Router

1. Select **Networking** from the **Policy** tab or the **Manager** tab depnding on which API you are using.
  <img src="images/nsxt/nsxt-30/tier-0-01.png">
 
1. Select **Tier-0 Logical Router**.
  <img src="images/nsxt/nsxt-30/tier-0-02.png">
 
1. Click **Add**.

1. Configure the new Tier-0 Router as follows:
  - **Name**: `T0-router`
  - **Edge Cluster**: `edge-cluster-1`
  - **HA mode**: `Active-Standby`
  - **Failover mode**: `Non-Preemptive`
  <img src="images/nsxt/nsxt-30/tier-0-03.png">

1. Click **Save** and verify.
  <img src="images/nsxt/nsxt-30/tier-0-04.png">
 
1. Select the T0 router.
  <img src="images/nsxt/nsxt-30/tier-0-05.png">

1. Select **Configuration** > **Router Ports**.
 
1. Click **Add**.

1. Configure a new router port as follows: 
  - **Name**: T0-uplink-1
  - **Type**: uplink
  - **Transport Node**: edge-node-1
  - **Logical Switch**: LS-T0-uplink
  - **Logical Switch Port**: Attach to a new switch port
  - **Subnet**: 10.173.62.50 / 24
  <img src="images/nsxt/nsxt-30/tier-0-06.png">

1. Click **Add** and verify.
  <img src="images/nsxt/nsxt-30/tier-0-07.png">

1. Select the T0 router.

1. Select **Configuration** > **Router Ports**.

1. Add a second uplink by creating a second router port for edge-node-2:
  - **Name**: T0-uplink-1
  - **Type**: uplink
  - **Transport Node**: edge-node-2
  - **Logical Switch**: LS-T0-uplink
  - **Logical Switch Port**: Attach to a new switch port
  - **Subnet**: 10.173.62.51 / 24

1. Once completed, verify that you have two connected router ports.
  <img src="images/nsxt/nsxt-30/tier-0-08.png">

##<a id='nsxt30-t0-router-config'></a> Configure and Test the Tier-0 Router

Create an HA VIP for the T0 router, and a default route for the T0 router. Then test the T0 router.

1. Select the Tier-0 Router you created.

1. Select **Configuration** > **HA VIP**.

1. Click **Add**.
  <img src="images/nsxt/nsxt-30/tier-0-09.png">

1. Configure the HA VIP as follows:
  - **VIP address**: 10.173.62.52/24, for example
  - **Uplink ports**: T0-uplink-1 and T0-uplink-2
  <img src="images/nsxt/nsxt-30/tier-0-10.png">

1. Click **Add** and verify.
  <img src="images/nsxt/nsxt-30/tier-0-11.png">

1. Select **Routing** > **Static Routes**.
  <img src="images/nsxt/nsxt-30/tier-0-12.png">

1. Click **Add**.
  - **Network**: `0.0.0.0/0`
  - **Next Hop**: `10.173.62.253`
  <img src="images/nsxt/nsxt-30/tier-0-13.png">

1. Click **Add** and verify. 
  <img src="images/nsxt/nsxt-30/tier-0-14.png">

1. Verify the Tier 0 router by making sure the T0 uplinks and HA VIP are reachable from your laptop.

For example:

```
> ping 10.173.62.50
PING 10.173.62.50 (10.173.62.50): 56 data bytes
Request timeout for icmp_seq 0
64 bytes from 10.173.62.50: icmp_seq=1 ttl=58 time=71.741 ms
64 bytes from 10.173.62.50: icmp_seq=0 ttl=58 time=1074.679 ms

> ping 10.173.62.51
PING 10.173.62.51 (10.173.62.51): 56 data bytes
Request timeout for icmp_seq 0
64 bytes from 10.173.62.51: icmp_seq=0 ttl=58 time=1156.627 ms
64 bytes from 10.173.62.51: icmp_seq=1 ttl=58 time=151.413 ms

> ping 10.173.62.52
PING 10.173.62.52 (10.173.62.52): 56 data bytes
64 bytes from 10.173.62.52: icmp_seq=0 ttl=58 time=6.864 ms
64 bytes from 10.173.62.52: icmp_seq=1 ttl=58 time=7.776 ms
```

##<a id='nsxt30-ip-blocks-pool'></a> Create IP Blocks and Pool for Compute Plane

TKGI requires a Floating IP Pool for NSX-T load balancer assignment and the following 2 IP blocks for Kubernetes pods and nodes:

- PKS-POD-IP-BLOCK: 172.16.0.0/16
- PKS-NODE-IP-BLOCK: 172.23.0.0/16 

1. In the **Manager** interface, go to **Networking** > **IP Address Pools** > **IP Block**.
  <img src="images/nsxt/nsxt-30/ib-blocks-pool-01.png">

1. Click **Add**.

1. Configure the Pod IP Block as follows:
  - **Name**: PKS-POD-IP-BLOCK
  - **CIDR**: 172.16.0.0/16
  <img src="images/nsxt/nsxt-30/ib-blocks-pool-02.png">

1. Click **Add** and verify.
  <img src="images/nsxt/nsxt-30/ib-blocks-pool-03.png">

1. Repeat same operation for the Node IP Block.
  - **Name**: PKS-NODE-IP-BLOCK
  - **CIDR**: 172.23.0.0/16

1. Click **Add** and verify. 
  <img src="images/nsxt/nsxt-30/ib-blocks-pool-04.png">

1. Select **IP Pools** tab.
  <img src="images/nsxt/nsxt-30/ib-blocks-pool-05.png">

1. Click **Add**.

1. Configure the IP pool as follows: 
  - **Name**: PKS-FLOATING-IP-POOL
  - **IP ranges**: 10.173.62.111 - 10.173.62.150
  - **CIDR**: 10.173.62.0/24
  <img src="images/nsxt/nsxt-30/ib-blocks-pool-06.png">

1. Click **Add** and verify.
  <img src="images/nsxt/nsxt-30/ib-blocks-pool-07.png">

##<a id='nsxt30-mgmt-plane'></a> Create Management Plane

Networking for the <%= vars.k8s_runtime_abbr %> Management Plane consists of a [Tier-1 Router and Switch](#nsxt30-t1-router) with [NAT Rules](#nsxt30-t0-nat) for the Management Plane VMs.

###<a id='nsxt30-t1-router'></a> Create Tier-1 Router and Switch 

Create Tier-1 Logical Switch and Router for TKGI Management Plane VMs. Complete the configuration by enabling Route Advertisement on the T1 router.

1. In the NSX Management console, navigate to **Networking > Logical Switches**.

1. Click **Add**.

1. Create the LS for TKGI Management plane VMs:
  - **Name**: LS-PKS-MGMT
  - **Transport Zone**: tz-overlay
  <img src="images/nsxt/nsxt-30/tier-1-01.png">

1. Click **Add** and verify creation of the T1 logical switch.
  <img src="images/nsxt/nsxt-30/tier-1-02.png">

1. Go to **Networking** > **Tier-1 Logical Router**.
  <img src="images/nsxt/nsxt-30/tier-1-03.png">

1. Click **Add**.

1. Configure the Tier-1 logical router as follows:
  - **Name**: T1-PKS-MGMT
  - **To router**: T0-router
  - **Edge Cluster**: edge-cluster-1
  - **Edge Cluster Members**: edge-node-1 and edge-node-2
  <img src="images/nsxt/nsxt-30/tier-1-04.png">

1. Click **Add** and verify.
  <img src="images/nsxt/nsxt-30/tier-1-05.png">

1. Select the T1 router and go to **Configuration** > **Router port**.
  <img src="images/nsxt/nsxt-30/tier-1-06.png">

1. Click **Add**.

1. Configure the T1 router port as follows:
  - **Name**: T1-PKS-MGMT-port
  - **Logical Switch**: LS-PKS-MGMT
  - **Subnet**: 10.1.1.1/24
  <img src="images/nsxt/nsxt-30/tier-1-07.png">

1. Click **Add** and verify.
  <img src="images/nsxt/nsxt-30/tier-1-08.png">

1. Select **Routing** tab.
  <img src="images/nsxt/nsxt-30/tier-1-09.png">

1. Click **Edit** and configure route advertisement as follows:
  - **Status**: Enabled
  - **Advertise All Connected Routes**: Yes
  <img src="images/nsxt/nsxt-30/tier-1-10.png">

1. Click **Save** and verify.
  <img src="images/nsxt/nsxt-30/tier-1-11.png">

###<a id='nsxt30-t0-nat'></a> Create NAT Rules 

You need to create the following NAT rules on the Tier-0 router for the TKGI Management Plane VMs.

- DNAT: `10.173.62.220` (for example) to access Ops Manager
- DNAT: `10.173.62.221` (for example) to access Harbor
- SNAT: `10.173.62.222` (for example) for all TKGI management plane VM traffic destined to the outside world

1. In the NSX Management console, navigate to **Networking** > **NAT**.

1. In the Logical Router field, select the T0-router you defined for TKGI.
  <img src="images/nsxt/nsxt-30/tier-0-nat-01.png">

1. Click **Add**.

1. Configure the Ops Manager DNAT rule as follows:
  - **Priority**: `1000`
  - **Action**: `DNAT`
  - **Protocol**: `Any Protocol`
  - **Destination IP**: `10.173.62.220`, for example
  - **Translated IP**: `10.1.1.2`, for example
  <img src="images/nsxt/nsxt-30/tier-0-nat-02.png">

1. Click **Add** and verify. 
  <img src="images/nsxt/nsxt-30/tier-0-nat-03.png">

1. Add a second DNAT rule for Harbor by repeating the same operation.
  - **Priority**: `1000`
  - **Action**: `DNAT`
  - **Protocol**: `Any Protocol`
  - **Destination IP**: `10.173.62.221`, for example
  - **Translated IP**: `10.1.1.6`, for example

1. Verify the creation of the DNAT rules.
  <img src="images/nsxt/nsxt-30/tier-0-nat-04.png">

1. Create the SNAT rule for the management plane traffic as follows:
  - **Priority**: `9024`
  - **Action**: `SNAT`
  - **Protocol**: `Any Protocol`
  - **Source IP**: `10.1.1.0/24`, for example
  - **Translated IP**: `10.173.62.222`, for example
    <img src="images/nsxt/nsxt-30/tier-0-nat-05.png">

1. Verify the creation of the SNAT rule. 
  <img src="images/nsxt/nsxt-30/tier-0-nat-06.png">

##<a id='nsxt-password-mgr'></a> Configure the NSX-T Password Interval (Optional)

The default NSX-T password expiration interval is 90 days. After this period, the NSX-T passwords will expire on all NSX-T Manager Nodes and all NSX-T Edge Nodes. To avoid this, you can extend or remove the password expiration interval, or change the password if needed.

<p class="note"><strong>Note:</strong> For existing <%= vars.product_short %> deployments, anytime the NSX-T password is changed you must update the BOSH and PKS tiles with the new passwords. See <a href="./password-management.html">Adding Infrastructure Password Changes to the <%= vars.product_short %> Tile</a> for more information.</p>

###<a id='nsxt-manager-password'></a> Update the NSX-T Manager Password and Password Interval

To update the NSX Manager password, perform the following actions on **one** of the NSX Manager nodes. The changes will be propagated to all NSX Manager nodes.

#### SSH into the NSX Manager Node

To manage user password expiration, you use the CLI on one of the NSX Manager nodes. 

To access a NSX Manager node, from Unix hosts use the command `ssh USERNAME@IP_ADDRESS_OF_NSX_MANAGER`. 

For example:

```
ssh admin@10.196.188.22
```

On Windows, use Putty and provide the IP address for NSX Manager. Enter the user name and password that you defined during the installation of NSX-T.

#### Retrieve the Password Expiration Interval

To retrieve the password expiration interval, use the following command:

[get user USERNAME password-expiration](https://vdc-download.vmware.com/vmwb-repository/dcr-public/0aa6ceb3-9f71-44f5-bef6-d4acab570b55/382a3731-d45e-43c1-ba0b-f98b64899e9c/nsxt_24_cli.html#get%20user%20%3Cusername%3E%20password-expiration)

For example:

```
NSX CLI (Manager, Policy, Controller 3.0.0.0.0.15946739). Press ? for cost or enter: help
nsx-mgr-1> get user admin password-expiration
Password expires 90 days after last change
```

#### Update the Admin Password

To update the user password, use the following command:

[set user USERNAME password NEW-PASSWORD old-password OLD-PASSWORD](https://vdc-download.vmware.com/vmwb-repository/dcr-public/0aa6ceb3-9f71-44f5-bef6-d4acab570b55/382a3731-d45e-43c1-ba0b-f98b64899e9c/nsxt_24_cli.html#set%20user%20%3Cusername%3E%20[password%20%3Cpassword%3E%20[old-password%20%3Cold-password%3E]]).

For example: 

```
set user admin password my-new-pwd old-password my-old-pwd
```

#### Set the Admin Password Expiration Interval

To set the password expiration interval, use the following command:

[set user USERNAME password-expiration PASSWORD-EXPIRATION](https://vdc-download.vmware.com/vmwb-repository/dcr-public/0aa6ceb3-9f71-44f5-bef6-d4acab570b55/382a3731-d45e-43c1-ba0b-f98b64899e9c/nsxt_24_cli.html#set%20user%20%3Cusername%3E%20password-expiration%20%3Cpassword-expiration%3E).

For example, the following command sets the password expiration interval to 120 days: 

```
set user admin password-expiration 120
```

#### Remove the Admin Password Expiration Interval

To remove password expiration, use the following command:

[clear user USERNAME password-expiration](https://vdc-download.vmware.com/vmwb-repository/dcr-public/0aa6ceb3-9f71-44f5-bef6-d4acab570b55/382a3731-d45e-43c1-ba0b-f98b64899e9c/nsxt_24_cli.html#clear%20user%20%3Cusername%3E%20password-expiration).

For example: 

```
clear user admin password-expiration
```

To verify:

```
nsx-mgr-1> clear user admin password-expiration
nsx-mgr-1> get user admin password-expiration
Password expiration not configured for this user
```

###<a id='nsxt-password-edge'></a> Update the Password for NSX Edge Nodes

To update the NSX Edge Node password, perform the following actions on **each** NSX Edge Node.

<p class="note"><strong>Note:</strong> Unlike the NSX-T Manager nodes, you must update the password or password interval on each Edge Node.</p>

#### Enable SSH

SSH on the Edge Node is disabled by default. You have to enable SSH on the Edge Node using the Console from vSphere.

```
start service ssh
set service ssh start-on-boot
```

#### SSH to the NSX Edge Node

For example:

```
ssh admin@10.196.188.25
```

#### Get the Password Expiration Interval for the Edge Node

For example:

```
nsx-edge> get user admin password-expiration
Password expires 90 days after last change
```

#### Update the User Password for the Edge Node

For example: 

```
nsx-edge> set user admin password my-new-pwd old-password my-old-pwd
```

#### Set the Password Expiration Interval

For example, the following command sets the password expiration interval to 120 days: 

```
nsx-edge> set user admin password-expiration 120
```

#### Remove the Password Expiration Interval

For example: 

```
NSX CLI (Edge 3.0.0.0.0.15946012). Press ? for command list or enter: help
nsx-edge-2> get user admin password-expiration
Password expires 90 days after last change. Current password will expire in 7 days.

nsx-edge-2> clear user admin password-expiration
nsx-edge-2> get user admin password-expiration
Password expiration not configured for this user
```

##<a id='next'></a> Next Steps

Once you have completed the installation of NSX-T v3.0, return to the TKGI installation workflow and proceed with the next phase of the process. See [Install Tanzu Kubernetes Grid Integrated Edition on vSphere with NSX-T Using Ops Manager](./vsphere-nsxt-index.html).
